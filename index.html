<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Planificador de Puntos Familiar — v4.7</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#2563eb" />
  <!-- iOS PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Puntos Familiar">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <header class="container header">
    <h1>Planificador de Puntos Familiar</h1>
    <p class="subtitle">Sebastián & Isa</p>
    <nav class="tabs">
      <button class="tab active" data-tab="resumen" aria-selected="true" type="button">Resumen</button>
      <button class="tab" data-tab="registro" aria-selected="false" type="button">Registro</button>
      <button class="tab" data-tab="config" aria-selected="false" type="button">Configuración</button>
    </nav>
  </header>

  <main class="container">
    <section id="resumen" class="tabcontent active" aria-labelledby="Resumen">
      <h2 class="sr-only">Resumen</h2>
      <div class="cards">
        <div class="card">
          <h3>Sebastián</h3>
          <p>Total puntos: <strong id="totalA">0</strong></p>
        </div>
        <div class="card">
          <h3>Isa</h3>
          <p>Total puntos: <strong id="totalB">0</strong></p>
        </div>
      </div>

      <div class="leader card soft">
        <h3>Marcador</h3>
        <p id="leaderText">Ingresa o crea un hogar en Configuración para sincronizar.</p>
      </div>
    </section>

    <section id="registro" class="tabcontent" aria-labelledby="Registro">
      <h2 class="sr-only">Registro</h2>
      <form id="logForm" class="form" novalidate>
        <label>Persona
          <select id="logWho" required>
            <option value="A">Sebastián</option>
            <option value="B">Isa</option>
          </select>
        </label>
        <label>Fecha
          <input type="date" id="logDate" required />
        </label>
        <label>Inicio
          <select id="logStart" required></select>
        </label>
        <label>Fin
          <select id="logEnd" required></select>
        </label>
        <label>Actividad
          <input type="text" id="logActivity" placeholder="Ej: Fútbol / Nadar / Oficina tarde" />
        </label>
        <div class="form-actions">
          <button type="submit" class="btn primary" id="submitBtn">Agregar</button>
        </div>
      </form>

      <div class="table-wrap">
        <table id="logTable" class="table">
          <thead>
            <tr>
              <th>Persona</th><th>Fecha</th><th>Inicio</th><th>Fin</th><th>Actividad</th><th>Puntos</th><th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section id="config" class="tabcontent" aria-labelledby="Configuración">
      <h2 class="sr-only">Configuración</h2>
      <div class="config card soft">
        <h3>Configuración</h3>

        <div class="ownerpref" id="ownerSetup">
          <div class="owner-buttons">
            <button class="btn" id="setOwnerA" type="button">Este es el iPhone de Sebastián</button>
            <button class="btn" id="setOwnerB" type="button">Este es el iPhone de Isa</button>
          </div>
        </div>

        <div class="ownerpref hidden" id="ownerIndicator">
          <small>Teléfono de: <strong id="ownerName">—</strong></small>
          <button class="btn" id="changeOwner" type="button">Cambiar</button>
        </div>

        <div class="household" id="housePanel">
          <label>Código del hogar
            <input id="houseId" type="text" placeholder="p.ej. CASA-123" />
          </label>
          <button class="btn" id="joinHouse" type="button">Unirse/Crear</button>
          <small id="authInfo">Configura Supabase y únete a un hogar.</small>
        </div>

        <div class="household hidden" id="houseIndicator">
          <div>
            <strong id="houseLabel">Hogar: —</strong><br />
            <small id="authInfo2">Conectado</small>
          </div>
          <button class="btn" id="changeHouse" type="button">Cambiar hogar</button>
        </div>
      </div>

      <details class="details">
        <summary>Tarifas por 30 min (24/7)</summary>
        <div class="grid">
          <div class="card soft">
            <h4>Lunes a Viernes</h4>
            <ul>
              <li>00:00–07:00 → 2</li>
              <li>07:00–08:30 → 4</li>
              <li>08:30–17:30 → 0</li>
              <li>17:30–20:30 → 6</li>
              <li>20:30–24:00 → 2</li>
            </ul>
          </div>
          <div class="card soft">
            <h4>Sábado y Domingo</h4>
            <ul>
              <li>00:00–08:00 → 1</li>
              <li>08:00–10:00 → 2</li>
              <li>10:00–12:00 → 1</li>
              <li>12:00–14:00 → 2</li>
              <li>14:00–17:30 → 1</li>
              <li>17:30–20:30 → 3</li>
              <li>20:30–24:00 → 1</li>
            </ul>
          </div>
        </div>
      </details>
    </section>
  </main>

  <footer class="container">
    <small>Hecho para Sebastián e Isa • Supabase online • <strong>v4.7</strong></small>
  </footer>

  <script>window.__APP_VERSION__ = "v4.7";</script>
  <script src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) { 
      window.addEventListener('load', () => { 
        navigator.serviceWorker.register('./service-worker.js').catch(console.error);
      });
    }
  </script>
</body>
</html>
